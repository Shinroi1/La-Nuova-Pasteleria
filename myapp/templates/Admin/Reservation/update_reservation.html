{% extends "Admin/admin_main.html" %}

{% load static %}

{% block content %}
<html>
<head>
    <link rel="stylesheet" href="{% static '/CSS/admin.css' %}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/select2/4.0.13/css/select2.min.css" rel="stylesheet"/>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

</head>
<body>

  <div class="container mt-5">
    <div class="col-md-8 offset-md-2 bg-light p-4 rounded shadow-sm">
      <h1 class="text-center mb-4">Update Normal Reservation Record</h1>


    {% if messages %}
    <ul class="messages">
        {% for message in messages %}
            <li class="{{ message.tags }}">{{ message }}</li>
        {% endfor %}
    </ul>
    {% endif %}
    
    <form method="POST" action="{% url 'update_reservation' current_record.id %}" autocomplete="off" novalidate>
      {% csrf_token %}

      <!-- Fullname -->
      <div class="form-group mb-3">
        <label for="fullname" class="form-label">Fullname</label>
        <input class="form-control" type="text" id="fullname" name="fullname" value="{{ form.fullname.value|default:'' }}" placeholder="Enter your full name" required>
      </div>

      <div class="form-group mb-3">
        <label for="email" class="form-label">Email</label>
        <input class="form-control" type="text" id="email" name="email" placeholder="Enter your email" required>
      </div>

      <!-- Phone Number -->
      <div class="form-group mb-3">
        <label for="phone" class="form-label">Phone Number</label>
        <input class="form-control" type="tel" id="phone" name="phone" value="{{ form.phone.value|default:'' }}" maxlength="11" placeholder="Enter your phone number" required>
      </div>

      <!-- Party Size -->
      <div class="form-group mb-3">
        <label for="party_size" class="form-label">Party Size</label>
        <input class="form-control" type="number" id="party_size" name="party_size" min="1" max="12" value="{{ form.party_size.value|default:'' }}" required>
      </div>

      <div class="form-group mb-3">
        <label for="selectedDishesListForm" class="form-label">Selected Dishes</label>
        <div id="selectedDishesListForm" class="form-control mb-2" readonly></div>
        <!-- Single Button to Open Modal -->
        <button type="button" class="btn btn-primary w-100" data-bs-toggle="modal" data-bs-target="#dishModalNormal">
          Select Dishes
        </button>
        <input type="hidden" id="selectedDishesInput" name="selected_dishes" value="{{ form.selected_dishes.initial }}">
      </div>
      
      <!-- Modal for Dish Selection -->
      <div class="modal fade" id="dishModalNormal" tabindex="-1" aria-labelledby="dishModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-xl">
          <div class="modal-content">
            <div class="modal-header">
              <h5 class="modal-title" id="dishModalLabel">Select Dishes</h5>
              <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
              <div class="row">
                <!-- Categories and dishes column (left) -->
                <div class="col-sm-6">
                  <!-- Categories dropdown -->
                  <div id="categories-normal">
                    <!-- Categories will be loaded here via JavaScript (from dishes.js) -->
                  </div>
      
                  <!-- Subcategories dropdown (dynamically loaded) -->
                  <div id="subcategories" style="display:none;">
                    <!-- Subcategories will be loaded here via JavaScript (from dishes.js) -->
                  </div>
      
                  <!-- Dishes with quantity inputs -->
                  <div id="dishesContainer">
                    <div id="dishes" style="display:none;">
                      <!-- Dishes will be loaded here via JavaScript (from dishes.js) -->
                    </div>
                  </div>
                </div>
      
                <!-- Selected dishes column (right) -->
                <div class="col-sm-6">
                  <h5>Selected Dishes</h5>
                  <div id="selectedDishesListModal" class="border p-2" style="height:300px; overflow-y:auto;">
                    <!-- Selected dishes will be displayed here -->
                  </div>
                </div>
              </div>
            </div>
            <div class="modal-footer">
              <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
              <button type="button" class="btn btn-primary" id="saveSelection">Save</button>
            </div>
          </div>
        </div>
      </div>
        
      <!-- Total Price -->
      <div class="form-group mb-3">
        <label for="total-price" class="form-label">Total Price</label>
        <input class="form-control" type="number" id="total-price" name="total-price" readonly>
      </div>

      <!-- Table Status -->
      <div class="form-group mb-3">
        <label for="id_table_status" class="form-label">Table Status</label>
        {{ form.table_status }}
      </div>

      <!-- Date & Time -->
      <div class="form-group mb-3">
        <label for="date" class="form-label">Date & Time Reservation</label>
        <input class="form-control" id="date" name="date" type="datetime-local" value="{{ form.date.value|date:'Y-m-d\\TH:i' }}" required>
      </div>

      <!-- Buttons -->
      <div class="d-flex justify-content-between">
        <button type="submit" class="btn btn-success">Update Record</button>
        <a href="{% url 'admin_reservation' %}" class="btn btn-secondary">Back</a>
      </div>
    </form>
  </div>
</div>

<script src="{% static  'js/admin_reservation.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js" integrity="sha384-I7E8VVD/ismYTF4hNIPjVp/Zjvgyol6VFvRkX/vR+Vc4jQkC+hVqc2pM8ODewa9r" crossorigin="anonymous"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>

</body>
</html>
{% endblock %}
