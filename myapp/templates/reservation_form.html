{% extends 'user_navbar.html' %}

{% load static %}

{% block content %}

<html>
<head>
    <meta charset="utf-8">
    <meta name="csrf-token" content="{{ csrf_token }}">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">

    <!-- Flatpickr CSS -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">

    <link rel="stylesheet" href="{% static '/CSS/admin.css' %}">
    <link rel="stylesheet" href="{% static 'CSS/reservation form.css' %}">

    <title>Reservation Form</title>
</head>

<body>
<div class="container my-5">
  <div class="row flex-column flex-md-row">
    
<!-- RULES SECTION -->
<div class="col-md-6 mb-4 mb-md-0 rules-box">
  <div class="format" style="font-family: 'Times New Roman', Times, serif;">
    <h2 class="mb-3"><i>Reservation Rules</i></h2>
    <p>Welcome to La Nouva! Please read our reservation rules carefully:</p>

    <h3 class="mt-4">Operating Hours:</h3>
    <ul class="rule-list">
      <li>Open daily from 10:00 AM to 9:00 PM (Monday to Sunday).</li>
    </ul>

    <h3 class="mt-4">Normal Reservations:</h3>
    <ul class="rule-list">
      <li>Note that pre-ordering is optional for the normal reservation</p>
      <li>You can make a reservation using the online form or by calling the restaurant.</li>
      <li>Maximum of 12 guests per reservation.</li>
      <li>Tables are held for 15 minutes (Grace Period). If the customer does not arrive within that period, the reservation will be canceled.</li>
    </ul>

    <h3 class="mt-4">Exclusive Reservations:</h3>
    <ul class="rule-list">
      <li>Exclusive reservations must be made by calling the restaurant.</li>
      <li>Maximum of 30 guests.</li>
      <li>The restaurant will be closed to the public for 3 hours during exclusive reservations.</li>
      <li>Reservation duration is strictly limited to 3 hours.</li>
      <li>Available time slots: 3:00 PM – 6:00 PM and 6:00 PM – 9:00 PM.</li>
      <li>On special occasions (e.g., Christmas), the 9:00 PM end time may be extended.</li>
    </ul>
  </div>
</div>

    <!-- FORM SECTION -->
    <div class="col-md-6">
      <section id="form">
        <div class="container own-container">
          <div class="form-header text-center mb-4">
            {% if success %}
                <div class="alert alert-success mt-3">
                    <strong>Success!</strong> Your reservation was submitted successfully!
                    Please arrive on time. We hold tables for 15 minutes after your scheduled time.
                    If you're running late, kindly call the restaurant.
                </div>
            {% endif %}
            <h2 class="fw-bold text-primary">Make Your Normal Reservation</h2>
            <p class="text-muted">Please complete the form below</p>
          </div>
          <form method="POST" action="{% url 'reservation_form' %}">

            {% csrf_token %}

            <div class="form-group group">
              <label for="fullname" class="font-weight-bold">Fullname</label>
              <input class="form-control" type="text" id="fullname" name="fullname" value="{{ form_data.fullname }}" placeholder="Enter your full name" required>
            </div>

            <div class="form-group group">
              <label for="email">Email</label>
              <input class="form-control" type="email" id="email" name="email" placeholder="Enter your email" value="{{ form_data.email }}">
            </div>

            <div class="form-group group">
              <label for="phone">Phone Number</label>
              <input class="form-control" type="tel" id="phone" name="phone" placeholder="Enter your phone number" maxlength="11" pattern="[0-9]{10,11}" value="{{ form_data.phone }}" required>
            </div>

            <div class="form-group">
              <label for="party_size">Party Size</label>
              <input class="form-control" type="number" id="party_size" name="party_size" min="1" max="12" value="{{ form_data.party_size|default:'1' }}" required>
            </div>

            <div class="form-group row">
              <div class="col-md-9">
                <label for="SelectedDishesDisplay">Selected Dishes</label>
                <div id="selectedDishesListForm" class="form-control" readonly></div>
                <input type="hidden" id="selectedDishesInput" name="selected_dishes" value='{{ selected_dishes_json|default:"{}"|safe }}'>
              </div> 
              <div class="col-md-3 d-flex align-items-end">
                <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#dishModalNormal">
                  Select Dishes
                </button>
              </div>
            </div>

            <!-- Dish Modal -->
            <div class="modal fade" id="dishModalNormal" tabindex="-1" aria-labelledby="dishModalLabel" aria-hidden="true">
              <div class="modal-dialog modal-xl">
                <div class="modal-content">
                  <div class="modal-header">
                    <h5 class="modal-title" id="dishModalLabel">Select Dishes</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                  </div>
                  <div class="modal-body">
                    <div class="row">
                      <div class="col-sm-6">
                        <div id="categories-normal"></div>
                        <div id="subcategories" style="display:none;"></div>
                        
                        <div id="dishesContainer">
                          <div id="dishes" style="display:none;"></div>
                        </div>
                      </div>
                      <div class="col-sm-6">
                        <h5>Selected Dishes</h5>
                        <div id="selectedDishesListModal" class="border p-2" style="height:300px; overflow-y:auto;"></div>
                      </div>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    <button type="button" class="btn btn-primary" id="saveSelection">Save</button>
                  </div>
                </div>
              </div>
            </div>
            <!-- End of Modal -->

            <div class="form-group">
              <label for="total-price">Total Price</label>
              <input class="form-control" type="number" id="total-price" name="total_price" readonly>
            </div>

            <div class="form-group">
              <label for="date">Date & Time Reservation</label>
              <input class="form-control" id="date" name="date" type="datetime-local" value="{{ form_data.date }}" required>
            </div>

            <br>

            <div class="form-btn">
              <button class="btn btn-success btn-lg" type="submit">Reserve Now</button>
            </div>
            
          </form>

 {% if form.errors %}
      <div class="alert alert-danger mt-3">
        <ul class="mb-0">
          {% for field, errors in form.errors.items %}
            <li><strong>{{ field }}:</strong>
              <ul>
                {% for error in errors %}
                  <li>{{ error }}</li>
                {% endfor %}
              </ul>
            </li>
          {% endfor %}
          {% for error in form.non_field_errors %}
            <li>{{ error }}</li>
          {% endfor %}
        </ul>
      </div>
      {% endif %}

      {% if error %}
        <div class="alert alert-danger mt-3">{{ error }}</div>
      {% endif %}

        </div>
      </section>
    </div>

  </div>
</div>

<script src="{% static 'js/reservation_form.js' %}"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

{% endblock %}

